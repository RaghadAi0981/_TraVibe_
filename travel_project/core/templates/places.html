{% extends "base.html" %}
{% block title %}Places Â· {{ city.name }} Â· TraVibe{% endblock %}

{% block content %}
<div class="mb-6">
  <div class="text-sm text-slate-500">
    <a class="hover:underline" href="{% url 'countries' %}">Countries</a>
    <span class="mx-2">/</span>
    <a class="hover:underline" href="{% url 'cities' city.country.id %}">{{ city.country.name }}</a>
    <span class="mx-2">/</span>
    <span>{{ city.name }}</span>
  </div>
<a href="{% url 'add_place' city.id %}"
   class="inline-flex items-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-slate-800">
  â• Add Place (Map Search)
</a>

  <h1 class="mt-3 text-3xl font-semibold tracking-tight">ğŸ“ Places in {{ city.name }}</h1>
  <p class="mt-1 text-slate-600">Search and filter by nature, good/bad, elderly-friendly, and work-friendly.</p>
</div>

<!-- SEARCH -->
<form method="get" class="mb-4 flex flex-wrap gap-2">
  <input
    type="text"
    name="q"
    value="{{ q }}"
    placeholder="Search places..."
    class="w-full sm:w-96 rounded-xl border bg-white px-4 py-2 text-sm shadow-sm focus:outline-none focus:ring"
  />

  {% if request.GET.nature %}<input type="hidden" name="nature" value="1">{% endif %}
  {% if request.GET.good %}<input type="hidden" name="good" value="1">{% endif %}
  {% if request.GET.elderly %}<input type="hidden" name="elderly" value="1">{% endif %}
  {% if request.GET.work %}<input type="hidden" name="work" value="1">{% endif %}

  <button
    type="submit"
    class="rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-slate-800"
  >
    Search
  </button>

  <a href="." class="rounded-xl border bg-white px-4 py-2 text-sm shadow-sm hover:bg-slate-50">
    Clear
  </a>
</form>

<!-- FILTER CHIPS -->
<div class="mb-5 flex flex-wrap gap-2">
  <a href="?q={{ q }}&nature=1" class="rounded-full border bg-white px-4 py-2 text-sm shadow-sm hover:bg-slate-50">ğŸŒ¿ Nature</a>
  <a href="?q={{ q }}&good=1" class="rounded-full border bg-white px-4 py-2 text-sm shadow-sm hover:bg-slate-50">âœ… Good</a>
  <a href="?q={{ q }}&elderly=1" class="rounded-full border bg-white px-4 py-2 text-sm shadow-sm hover:bg-slate-50">ğŸ‘´ Elderly â‰¥ 4</a>
  <a href="?q={{ q }}&work=1" class="rounded-full border bg-white px-4 py-2 text-sm shadow-sm hover:bg-slate-50">ğŸ’» Work â‰¥ 4</a>
</div>

<!-- PLACES GRID -->
<div class="grid gap-4 md:grid-cols-2">
  {% for place in places %}
  <a href="{% url 'place_detail' place.id %}"
     class="rounded-2xl border bg-white p-5 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md">
    <div class="flex items-start justify-between gap-3">
      <div>
        <h2 class="text-lg font-semibold">{{ place.name }}</h2>
        <p class="mt-1 text-sm text-slate-600">{{ place.get_category_display }}</p>
      </div>

      <span class="shrink-0 rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-700">
        {{ place.category }}
      </span>
    </div>

    {% if place.rating %}
      <div class="mt-3 flex flex-wrap items-center gap-2">
        {% if place.rating.good_or_bad == "good" %}
          <span class="rounded-full bg-emerald-100 px-3 py-1 text-xs font-medium text-emerald-800">GOOD</span>
        {% else %}
          <span class="rounded-full bg-rose-100 px-3 py-1 text-xs font-medium text-rose-800">BAD</span>
        {% endif %}

        {% if place.rating.good_or_bad == "good" and place.rating.elderly_score >= 4 and place.rating.young_score >= 4 and place.rating.work_score >= 4 and place.rating.nature_score >= 4 %}
          <span class="rounded-full bg-amber-100 px-3 py-1 text-xs font-medium text-amber-800">â­ Recommended</span>
        {% endif %}
      </div>

      <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
        <div class="rounded-xl bg-slate-50 p-2">ğŸ‘´ Elderly: <span class="font-semibold">{{ place.rating.elderly_score }}/5</span></div>
        <div class="rounded-xl bg-slate-50 p-2">ğŸ’ Young: <span class="font-semibold">{{ place.rating.young_score }}/5</span></div>
        <div class="rounded-xl bg-slate-50 p-2">ğŸ’» Work: <span class="font-semibold">{{ place.rating.work_score }}/5</span></div>
        <div class="rounded-xl bg-slate-50 p-2">ğŸŒ¿ Nature: <span class="font-semibold">{{ place.rating.nature_score }}/5</span></div>
      </div>

    {% else %}
      <p class="mt-3 text-sm text-slate-500">No rating yet.</p>
    {% endif %}
  </a>
  {% empty %}
  <div class="rounded-2xl border bg-white p-6 text-slate-600">
    No places yet. Add some in <a class="underline" href="/admin/">Admin</a>.
  </div>
  {% endfor %}
</div>
{% endblock %}
