{% extends "base.html" %}
{% block title %}Add Place · {{ city.name }} · TraVibe{% endblock %}

{% block content %}
<div class="mb-6">
  <div class="text-sm text-slate-500">
    <a class="hover:underline" href="{% url 'countries' %}">Countries</a>
    <span class="mx-2">/</span>
    <a class="hover:underline" href="{% url 'cities' city.country.id %}">{{ city.country.name }}</a>
    <span class="mx-2">/</span>
    <a class="hover:underline" href="{% url 'places' city.id %}">{{ city.name }}</a>
    <span class="mx-2">/</span>
    <span>Add Place</span>
  </div>

  <h1 class="mt-3 text-3xl font-semibold tracking-tight">➕ Add a place (Map Search)</h1>
  <p class="mt-1 text-slate-600">Search by name, then click Save to store it with location.</p>
</div>

<form method="get" class="mb-4 flex flex-wrap gap-2">
  <input
    type="text"
    name="q"
    value="{{ q }}"
    placeholder="Search (e.g., Hilton, Starbucks, Mountain, Park...)"
    class="w-full sm:w-[420px] rounded-xl border bg-white px-4 py-2 text-sm shadow-sm focus:outline-none focus:ring"
  />

  <select name="category" class="rounded-xl border bg-white px-3 py-2 text-sm shadow-sm">
    <option value="hotel" {% if category == "hotel" %}selected{% endif %}>Hotel</option>
    <option value="restaurant" {% if category == "restaurant" %}selected{% endif %}>Restaurant</option>
    <option value="cafe" {% if category == "cafe" %}selected{% endif %}>Coffee</option>
    <option value="mountain" {% if category == "mountain" %}selected{% endif %}>Mountain</option>
    <option value="nature" {% if category == "nature" %}selected{% endif %}>Nature</option>
    <option value="attraction" {% if category == "attraction" %}selected{% endif %}>Attraction</option>
    <option value="coworking" {% if category == "coworking" %}selected{% endif %}>Coworking</option>
  </select>

  <button class="rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-slate-800">
    Search
  </button>

  <a href="{% url 'places' city.id %}" class="rounded-xl border bg-white px-4 py-2 text-sm shadow-sm hover:bg-slate-50">
    Cancel
  </a>
</form>

{% if error %}
<div class="mb-4 rounded-2xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-700">
  Error: {{ error }}
</div>
{% endif %}

{% if q and results %}
<div class="grid gap-3">
  {% for r in results %}
  <div class="rounded-2xl border bg-white p-4 shadow-sm">
    <div class="flex flex-wrap items-start justify-between gap-3">
      <div>
        <div class="text-base font-semibold">
          {{ r.display_name|truncatechars:80 }}
        </div>
        <div class="mt-1 text-xs text-slate-500">
          Lat: {{ r.lat }} · Lon: {{ r.lon }}
        </div>
      </div>

      <form method="post" class="shrink-0">
        {% csrf_token %}
        <input type="hidden" name="name" value="{{ r.name|default:r.display_name|truncatechars:120 }}">
        <input type="hidden" name="lat" value="{{ r.lat }}">
        <input type="hidden" name="lon" value="{{ r.lon }}">
        <input type="hidden" name="display_name" value="{{ r.display_name }}">
        <input type="hidden" name="category" value="{{ category }}">

        <button class="rounded-xl bg-emerald-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-emerald-700">
          Save
        </button>
      </form>
    </div>
  </div>
  {% endfor %}
</div>
{% elif q %}
<div class="rounded-2xl border bg-white p-6 text-slate-600">
  No results found. Try a different keyword.
</div>
{% endif %}
{% endblock %}
